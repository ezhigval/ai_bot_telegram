## Механизм взаимодействия ИИ-агентов внутри репозитория

Этот документ описывает, **как несколько ИИ-агентов и ты как владелец** должны работать с этим репозиторием, чтобы не мешать друг другу и эффективно координироваться.

Идея простая: **вся координация проходит через файлы в `docs/`** — требования, архитектура, промпты и единый список задач.  
Любой ИИ-агент, подключённый к этому репо, считается «послушным» этому протоколу.

---

### 1. Основные документы

- `docs/requirements.md` — требования к системе.
- `docs/architecture.md` — архитектура ядра, клиентов и интеграций.
- `docs/roadmap.md` — этапы развития проекта.
- `docs/agents_prompts.md` — роли и базовые системные промпты для трёх агентов-разработчиков.
- `docs/agents_process.md` — **этот документ**, описывающий процесс командной работы.
- `docs/tasks.md` — единый бэклог задач с распределением по агентам и статусами.

Перед началом работы **каждый агент** обязан:

1. Прочитать `docs/requirements.md`, `docs/architecture.md`, `docs/roadmap.md`.
2. Прочитать `docs/agents_prompts.md` и свой раздел в нём.
3. Прочитать `docs/tasks.md` и отфильтровать задачи по своей роли.

---

### 2. Формат задач и статусов (`docs/tasks.md`)

Все задачи и их статусы живут в одном файле `docs/tasks.md`.  
Формат — простой Markdown со списками:

- Статусы:
  - `[ ]` — задача открыта;
  - `[~]` — задача в работе;
  - `[x]` — задача выполнена.
- Название агента указывается в круглых скобках:
  - `(Agent MacClient)`
  - `(Agent Telegram)`
  - `(Agent Core/LLM)`

**Пример строки задачи:**

- `[ ] (Agent Telegram) Подключить обработку «кружочков» и передавать их в агента как MessageTypeVideo`

**Правила для агентов:**

- Агент **может изменять статус** только у задач, помеченных его ролью.
- Если при выполнении задачи появляется необходимость в подзадачах:
  - агент **может добавить** подзадачи под своей ролью;
  - формулировки должны быть максимально конкретными.
- Если задача кажется некорректной/устаревшей:
  - агент добавляет короткий комментарий рядом или ниже;
  - не удаляет задачи без явного указания «главного инженера» в тексте.

---

### 3. Роли агентов и ответственность

Роли подробно описаны в `docs/agents_prompts.md`, здесь — короткое напоминание:

- **Agent MacClient**
  - Разработка нативного macOS‑клиента (Swift/SwiftUI).
  - UI, UX, авторизация, интеграция с ядром по HTTP/WebSocket.
  - Не трогает бизнес-логику ИИ, только клиент.

- **Agent Telegram**
  - Телеграм‑оболочка на Go.
  - Обработка всех типов сообщений и проксирование их в ядро.
  - Минимум логики, максимум стабильности: адаптер между Telegram и агентом.

- **Agent Core/LLM**
  - Ядро ИИ, память, LLM, инструменты.
  - API для клиентов (Mac/Telegram), обучение на истории, выбор инструментов.

Ты как «главный инженер» (текущий ассистент) отвечаешь за:

- консистентность требований и архитектуры (`requirements`, `architecture`, `roadmap`);
- формирование и приоритизацию задач в `docs/tasks.md`;
- контроль, чтобы агенты не выходили за рамки своей зоны ответственности.

---

### 4. Протокол работы агента в одной сессии

Каждый ИИ-агент (MacClient, Telegram, Core/LLM), начиная новую сессию работы с репозиторием, действует по шагам:

1. **Синхронизация контекста**
   - перечитать `docs/architecture.md` и `docs/requirements.md`, если они менялись;
   - перечитать свой раздел в `docs/agents_prompts.md`;
   - открыть `docs/tasks.md` и найти свои задачи со статусом `[ ]` или `[~]`.
2. **Выбор задачи**
   - взять самую приоритетную задачу для своей роли (обычно сверху или помеченную как приоритетную);
   - пометить её как `[~]` (в работе).
3. **Планирование**
   - в своём ответе пользователю/тимлиду кратко расписать шаги реализации;
   - при необходимости — создать подзадачи в `docs/tasks.md` под своей ролью.
4. **Реализация**
   - вносить изменения только в те файлы, которые относятся к его зоне ответственности;
   - не ломать контракты других частей системы без обновления архитектурных документов.
5. **Завершение задачи**
   - обновить статус задачи на `[x]` в `docs/tasks.md`;
   - при необходимости — добавить короткий комментарий «что сделано» рядом с задачей или в отдельном разделе «Notes».

---

### 5. Механизм косвенной коммуникации между агентами

Поскольку агенты не общаются напрямую, они взаимодействуют через репозиторий:

- **Через задачи**:
  - если Agent Core/LLM ожидает изменений от Agent Telegram, он добавляет задачу вида:
    - `[ ] (Agent Telegram) Обновить формат `agent.Input`, чтобы передавать новое поле X`
  - наоборот, Agent Telegram может завести задачу для ядра:
    - `[ ] (Agent Core/LLM) Добавить поддержку нового типа сообщения в Agent.Reply`

- **Через архитектуру и требования**:
  - любые изменения в общих контрактах (структуры данных, API) должны отражаться в `docs/architecture.md`;
  - после изменения контракта агент добавляет связанную задачу для других агентов, если это их затрагивает.

- **Через комментарии в `docs/tasks.md`**:
  - короткие пометки типа «зависит от задачи X» или «требуется обновление API» помогают другим агентам сориентироваться.

---

### 6. Важные запреты и ограничения

- Никакой агент **не имеет права**:
  - менять системные промпты других агентов в `docs/agents_prompts.md` без указания главного инженера;
  - удалять задачи других агентов;
  - кардинально менять архитектуру без обновления `docs/architecture.md`.
- Любое крупное изменение:
  - сначала описывается в `docs/architecture.md` и/или `docs/requirements.md`;
  - затем под него создаются задачи в `docs/tasks.md`;
  - только после этого вносятся изменения в код.

---

### 7. Как подключать новых агентов или менять язык/технологии

- Если в будущем решишь, что:
  - Telegram‑часть должна быть не на Go, а на другом языке;
  - ядро стоит переписать;
  - нужен новый агент (например, отдельный «Code Assistant»),
- тогда:
  1. Мы обновляем `docs/architecture.md` (что именно меняется и почему).
  2. Расширяем или корректируем `docs/agents_prompts.md` (новая роль, новый стек).
  3. Добавляем/обновляем задачи в `docs/tasks.md`.

С точки зрения агентов, это всё равно остаётся **одной и той же системой координации через файлы**.


